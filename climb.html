<!DOCTYPE html>
<html>
  <meta charset="UTF-8">
  <title>Crusher Crew</title>
  <style>
  </style>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  Can statistical analysis help you crush V15 boulders?<br>
  Maybe a little.
  <div id="pie"></div>
  <script src="libs/d3/d3.min.js" charset="utf-8"></script>
  <script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
  <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>
  <link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css">
  <!-- <link rel="stylesheet" type="text/css" href="content/style-index.css"> -->
<style>

/*only remaining issue: switching horizontally between rect and text, momentary de-bold. try grouping rect with text. next up: pull out pie slices. highlighting legend rects with black border is a final tweak if it's easy. also 5 rows of 3 might be sexier. also complete data. also don't spend too much time on this; there are cooler components ahead like the height-weight scatter. do I want mouseover the actual pie to be functional, or just mouseover legend?"*/
/*.legend-text:hover {
    
    font-weight: 700;
}*/
.strongbold {
  font-weight: 700;
}

</style>

  <script>
    // http://www.99boulders.com/blog/hardest-boulder-problems/

    // haven't gone through this one:
    // http://www.hardclimbs.info/climbers?join_model=climber&sort_column=last_name&sort_direction=asc

    // http://www.scribd.com/doc/21938101/Hardest-Boulder-Problems#scribd

    // http://www.australianbouldering.com/interviews/fred.html
    
    // get hard copies of these to cover your ass

    // birth country pie chart
    // height-weight scatter with fit line, comp. country avgs, other elite sports

    // potential other data:  time between starting climbing and first v15
    // number of v15s



d3.csv("climbers-partial.csv", function(data) {
var pie_svg = d3.select("#pie")
  .append("svg")
  .attr("width", getInnerWidth(d3.select("#pie")))
  .attr("height", 1000);

  var pie = d3.layout.pie()
  .sort(null)
  .value(function(d) { return d; }); 

 

var countries  = [];
data.forEach(function(d) {
  if (countries.indexOf(d["birth_country"]) == -1) {
    countries.push(d["birth_country"]);
  }
});


var freq = [];
for (i = 0; i < countries.length; i++) {
  freq.push(0);
}
data.forEach(function(d){
  freq[countries.indexOf(d["birth_country"])] += 1;

});


    // select pie paths
  var pie_path = pie_svg.selectAll("#categ")
      .data(pie(freq));

function getInnerWidth(element) {
    var style = window.getComputedStyle(element.node(), null);
    return parseInt(style.getPropertyValue('width'));
};

  var pie_group = pie_path.enter().append("g").attr("class",function(d,i){return i});

var arc = d3.svg.arc()
  .outerRadius(100)
  .innerRadius(0);

  var arc_text = d3.svg.arc()
  .outerRadius(180)
  .innerRadius(0);

var domain = [];
for (i = 0; i < countries.length; i++) {
  domain.push(i);
}

var colors = ['rgb(166,206,227)','rgb(31,120,180)','rgb(178,223,138)','rgb(51,160,44)','rgb(251,154,153)','rgb(227,26,28)','rgb(253,191,111)','rgb(255,127,0)','rgb(202,178,214)','rgb(106,61,154)','rgb(255,255,153)','rgb(177,89,40)','#D6AD33','#996600','#669999'];

  var pie_color_scale = d3.scale.ordinal()
  .domain(domain) 
  .range(colors);

  // add new slices for first time
  pie_group.append("path")
      // .attr("class", "categ")

      .attr("class", function(d,i){return "categ" + i})
      .attr("fill", function(d, i) {
        return pie_color_scale(i);
      })
      .attr("d", function(d) {
        return arc(d);
      })
      .attr("transform", "translate(130, 120)")
      .each(function(d) { this._current = d; });


var lab_x = 130;
var lab_y = 124;
  pie_labels = pie_group.append("text")
    .attr("class", function(d,i){return "label" + i})
    .attr("id", function(d,i){return i})
    .style("font-weight", "bold")
    .attr("transform", function(d) {
      var x = arc_text.centroid(d)[0] + lab_x;
      var y = arc_text.centroid(d)[1] + lab_y;
      return "translate(" + x + ", " + y + ")";
    })

    .attr("text-anchor", "middle")
    .attr("fill", "black")
    .text(function(d) {
      // return total 
      if(d.value > 0) {
        return d.value;
      }
    });



function bold(categ) {
  
  var text_id = "#text" + categ.id;
  // can't use stroke-width for text, dummy!
// d3.select(text_id).style("font-weight","bold");
d3.select(text_id).classed("strongbold",true);
var slice_id = ".categ" + categ.id;
var fish = d3.select(slice_id);
fish
.transition(1000)
.attr("transform",function(d) {return "translate(" +(130+.2*arc_text.centroid(d)[0]) +", "+(120+.2*arc_text.centroid(d)[1])+")"});

var label_id = ".label" + categ.id;
var fish = d3.select(label_id);
fish
.transition(1000)
.attr("transform",function(d) {return "translate(" +(arc_text.centroid(d)[0] + lab_x+.2*arc_text.centroid(d)[0]) +", "+(arc_text.centroid(d)[1] + lab_y+.2*arc_text.centroid(d)[1])+")"});



}

function unbold(categ) {

  
  var text_id = "#text" + categ.id;
  // can't use stroke-width for text, dummy!
// d3.select(text_id).style("font-weight","normal");
d3.select(text_id).classed("strongbold",false);

var slice_id = ".categ" + categ.id;
var fish = d3.select(slice_id);
fish
.transition(1000)
.attr("transform", "translate(130, 120)")

var label_id = ".label" + categ.id;
var fish = d3.select(label_id);
fish
.transition(1000)
.attr("transform",function(d) {return "translate(" +(arc_text.centroid(d)[0] + lab_x)+", "+(arc_text.centroid(d)[1] + lab_y)+")"});
}

// construct legend
var i_mod = 0;
    for (i = 0; i < countries.length; i++) {
      var group = pie_svg.append("g")
      .attr("id", i)
      .on("mouseover",function(){var noodle = this; bold(this);})
    .on("mouseout",function(){var noodle = this; unbold(this);});


      group.append("rect")

      .attr("id", i)

      .attr("class","legend-rect")
      // .attr("class", "dumb")
      .attr("x", function() {if (i < 8) {return 250} else {return 450}})
    .attr("y", function() {if (i > 7) {return 40*i_mod-20} else {return 40*i_mod}})
    .attr("width", 20)
    .attr("height", 20)
    // .on("mouseover",function(){var noodle = this; bold(this);})
    // .on("mouseout",function(){var noodle = this; unbold(this);})
    .attr("fill", colors[i]);

    group.append("rect")
      .attr("x", function() {if (i < 8) {return 270} else {return 470}})
    .attr("y", function() {if (i > 7) {return 40*i_mod-20} else {return 40*i_mod}})
    .attr("width", 20)
    .attr("height", 20)
    .attr("fill", "white");

    group.append("text")
      .attr("id", "text" + i)
    //     .on("mouseover",function(){var noodle = this; bold(this);})
    // .on("mouseout",function(){var noodle = this; unbold(this);})

  
      .attr("class", "legend-text")
      // .on("mouseover", function(){var noodle = this; bold(noodle);})
      .attr("x", function() {if (i < 8) {return 280} else {return 480}})
    .attr("y", function() {if (i > 7) {return 40*i_mod-5} else {return 40*i_mod+15}})
    .text(countries[i]);

    if (i == 7) {
      i_mod = 0;
    }
    i_mod++;
    }

var legend_texts = d3.selectAll(".legend-text");
var legend_rects = d3.selectAll(".legend-rect");



});
  </script>
</html>